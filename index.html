<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Budget Tracker</title>
<link rel="stylesheet" href="styles.css"> 
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<svg style="display:none;">
<symbol id="repeat_manage" viewBox="0 0 16 16">
  <g>
    <path d="M15.72,6.7c0-.14-.11-.25-.25-.25h-3.93c-.06,0-.11.02-.16.06-.11.09-.12.25-.03.35l.8.96c.75.1,1.42.43,1.94.92l1.57-1.89s.06-.1.06-.16h0Z"/>
    <path d="M4.47,8.45c.14,0,.25-.11.25-.25,0-.06-.02-.11-.06-.16l-1.97-2.36c-.09-.11-.25-.12-.35-.03,0,0-.02.02-.03.03l-1.97,2.36c-.09.11-.07.26.03.35.04.04.1.06.16.06,0,0,3.94,0,3.94,0Z"/>
    <path d="M3.1,8.45h-1.02c.24,1.42.98,2.71,2.1,3.62,1.33,1.1,2.98,1.52,4.56,1.32-.21-.29-.36-.62-.47-.97-2.43.13-4.66-1.51-5.17-3.97Z"/>
    <path d="M11.82,2.83c-2.56-2.11-6.34-1.75-8.45.81,0,0,0,.02-.02.03-.17.22-.13.53.09.7s.53.13.7-.09c.92-1.11,2.3-1.82,3.86-1.82,2.38,0,4.42,1.67,4.9,4h1.02c-.24-1.42-.98-2.71-2.1-3.62h0Z"/>
  </g>
  <path d="M12.21,8.56c-.17-.56-.96-.56-1.13,0l-.04.14c-.09.31-.42.49-.73.4-.04-.01-.08-.03-.11-.05l-.12-.07c-.51-.28-1.08.28-.8.8l.07.12c.18.33,0,.74-.35.84l-.14.04c-.56.17-.56.96,0,1.13l.14.04c.31.09.49.42.4.73,0,.04-.03.08-.05.11l-.07.12c-.28.51.28,1.08.8.8l.12-.07c.28-.15.64-.05.8.23.02.04.04.08.05.11l.04.14c.17.56.96.56,1.13,0l.04-.14c.09-.31.42-.49.73-.4.04.01.08.03.11.05l.12.07c.51.28,1.08-.28.8-.8l-.07-.12c-.15-.28-.05-.64.23-.8.04-.02.08-.04.11-.05l.14-.04c.56-.17.56-.96,0-1.13l-.14-.04c-.31-.09-.49-.42-.4-.73,0-.04.03-.08.05-.11l.07-.12c.28-.51-.28-1.08-.8-.8l-.12.07c-.28.15-.64.05-.8-.23-.02-.04-.04-.08-.05-.11l-.04-.14h.01ZM11.65,12.52c-.65,0-1.17-.53-1.17-1.17s.53-1.17,1.17-1.17,1.17.53,1.17,1.17-.53,1.17-1.17,1.17h0Z"/>
  
</symbol>
<symbol id="repeat_add" viewBox="0 0 16 16">
  <path d="M14.72,11.89c0,1.69-1.37,3.07-3.07,3.07s-3.07-1.37-3.07-3.07,1.37-3.07,3.07-3.07,3.07,1.37,3.07,3.07M11.84,10.55c0-.11-.09-.19-.19-.19s-.19.09-.19.19v1.15h-1.15c-.11,0-.19.09-.19.19s.09.19.19.19h1.15v1.15c0,.11.09.19.19.19s.19-.09.19-.19v-1.15h1.15c.11,0,.19-.09.19-.19s-.09-.19-.19-.19h-1.15v-1.15Z"/>
  <g>
    <path d="M15.72,7.25c0-.14-.11-.25-.25-.25h-3.93c-.06,0-.11.02-.16.06-.11.09-.12.25-.03.35l.8.96c.75.1,1.42.43,1.94.92l1.57-1.89s.06-.1.06-.16Z"/>
    <path d="M4.47,9c.14,0,.25-.11.25-.25,0-.06-.02-.11-.06-.16l-1.97-2.36c-.09-.11-.25-.12-.35-.03-.01,0-.02.02-.03.03l-1.97,2.36c-.09.11-.07.26.03.35.04.04.1.06.16.06h3.93Z"/>
    <path d="M3.1,9h-1.02c.24,1.42.98,2.71,2.1,3.62,1.33,1.1,2.98,1.52,4.56,1.32-.21-.29-.36-.62-.47-.97-2.43.13-4.66-1.51-5.17-3.97Z"/>
    <path d="M11.82,3.38c-2.56-2.11-6.34-1.75-8.45.81,0,0-.01.02-.02.03-.17.22-.13.53.09.7s.53.13.7-.09c.92-1.11,2.3-1.82,3.86-1.82,2.38,0,4.42,1.67,4.9,4h1.02c-.24-1.42-.98-2.71-2.1-3.62Z"/>
  </g>
</symbol>
</svg>

<div class="top-bar" style="justify-content:space-between; align-items:flex-start;">
  <h1>CashTracker</h1>
  <div id="authStatus" style="text-align:right; min-width:180px;">
    <button onclick="openAuthModal()" id="mainLoginBtn">Login / Sign Up</button>
  </div>
</div>
<div class="top-bar">
  <div>
    <label>
      <select id="currency" onchange="changeCurrency()">
        <option value="$">USD ($)</option>
        <option value="€">EUR (€)</option>
        <option value="£">GBP (£)</option>
        <option value="¥">JPY (¥)</option>
        <option value="¥">CNY (¥)</option>
        <option value="₽">RUB (₽)</option>
        <option value="₸">KZT (₸)</option>
      </select>
    </label>
  </div>
  <div id="totalBalance">Total Balance: $0</div>
</div>

<div class="main-grid">
  
  <div class="card main-table-card">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
      <button onclick="prevMonth()"><i class="bi bi-arrow-left-short"></i></button>
      <div id="monthLabel">All Time</div>
      <button onclick="nextMonth()"><i class="bi bi-arrow-right-short"></i></button>
    </div>
    <div id="monthBalance">Monthly Balance: $0</div>
    <div class="entry-table-scroll">
      <table>
        <thead>
          <tr>
            <th><i class="bi bi-chat-square-text-fill"></i></th>
            <th><i class="bi bi-cash-stack"></i></th>
            <th><i class="bi bi-calendar-date-fill"></i></th>
          </tr>
        </thead>
        <tbody id="entries"></tbody>
      </table>
    </div>
  </div>

  <div class="card chart-card">
    <canvas id="categoryChart"></canvas>
  </div>

  <div class="right-column-container">
    <div class="card controls-card">
      <button onclick="openModal()"><i class="bi bi-plus-square-fill"></i> New Entry</button>
      <button onclick="openRepeatModal()"><svg class="icon" width="20" height="20" style="margin-bottom: -3px;"><use href="#repeat_add" ></use></svg> New Repeat</button>
      <a href="./manage-repeats" class="button-as-link">
        <svg class="icon" width="20" height="20" style="margin-bottom: -5px;"><use href="#repeat_manage"></use></svg> Manage Repeats
      </a>
    </div>
    
    <div class="card balance-card">
        <h3 style="text-align:center; margin-bottom: 10px;">Monthly Total Balance</h3>
        <p style="text-align:center; font-size:0.9em; color:#00ffd5; margin-bottom:15px;">
            *Click "Total Balance" above for full chart*
        </p>
        <div id="monthlyBalancePreview" style="height: 120px;">
             </div>
    </div>
  </div>

</div>
<div id="authModal" class="modal">
    <div class="modal-content small-modal">
        <span class="close" onclick="closeAuthModal()">&times;</span>
        <h2 id="authTitle">Login / Sign Up</h2>
        <label>Email:</label>
        <input type="email" id="authEmail" placeholder="user@example.com">
        <label>Password:</label>
        <input type="password" id="authPassword" placeholder="Minimum 6 characters">
        
        <button onclick="handleAuthAction('login')" id="loginBtn">Login</button>
        <button onclick="handleAuthAction('signup')" id="signupBtn" style="background:#555; color:#eee;">Sign Up</button>
        <p style="text-align:center; margin-top:10px; font-size: 0.8em; color: #999;">
            Note: If you are signing up, this will create a new account.
        </p>
    </div>
</div>

<div id="actionModal" class="modal">
  <div class="modal-content small-modal">
    <span class="close" onclick="closeActionModal()">&times;</span>
    <h2 id="actionModalTitle">Entry Actions</h2>
    <p id="actionModalReason" style="text-align:center; margin-top:10px; font-weight:bold;"></p>
    <div style="display:flex; justify-content:space-between; margin-top:15px;">
        <button id="actionEditBtn" style="flex-grow:1; margin-right:5px;" onclick="handleActionClick('edit')">Edit</button>
        <button id="actionDeleteBtn" style="flex-grow:1; margin-left:5px; background:#ff4c4c;" onclick="handleActionClick('delete')">Delete</button>
    </div>
  </div>
</div>
<div id="entryModal" class="modal">
  <div class="modal-content small-modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2 id="modalTitle">New Entry</h2>
    <label>Type:</label>
    <select id="type">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
    <label>Reasoning (optional):</label>
    <input type="text" id="reason" placeholder="Description">
    <label>Amount*:</label>
    <input type="number" id="amount" placeholder="Amount">
    <label>Category (optional):</label>
    <input list="categoryList" id="category" placeholder="Type or select category">
    <datalist id="categoryList"></datalist>
    <label>Date (optional):</label>
    <input type="date" id="date">
    <button onclick="saveEntry()">Save</button>
  </div>
</div>

<div id="repeatModal" class="modal">
  <div class="modal-content small-modal">
    <span class="close" onclick="closeRepeatModal()">&times;</span>
    <h2>New Repeating Entry</h2>
    <label>Type:</label>
    <select id="repeatType">
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select>
    <label>Reasoning:</label>
    <input type="text" id="repeatReason" placeholder="Description">
    <label>Amount*:</label>
    <input type="number" id="repeatAmount" placeholder="Amount">
    <label>Category:</label>
    <input list="categoryList" id="repeatCategory" placeholder="Type or select category">
    
    <div style="display:flex; gap:10px;">
        <div style="flex-grow:1;">
            <label>Repeats every:</label>
            <input type="number" id="repeatInterval" placeholder="1" value="1" min="1" style="margin-bottom:0;">
        </div>
        <div style="flex-grow:1;">
            <label>Frequency:</label>
            <select id="repeatFrequency">
                <option value="days">Day(s)</option>
                <option value="weeks">Week(s)</option>
                <option value="months" selected>Month(s)</option>
                <option value="years">Year(s)</option>
            </select>
        </div>
    </div>
    
    <label>Start Date:</label>
    <input type="date" id="repeatStartDate">
    <label>End Date (optional):</label>
    <input type="date" id="repeatEndDate">
    <button onclick="saveRepeatEntry()">Save Repeating Entry</button>
    <p style="text-align:center; margin-top:10px; font-size: 0.8em; color: #999;">
            Repeating entries will be generated based on the start date and chosen frequency.
        </p>
  </div>
</div>

<div id="monthlyBalanceModal" class="modal">
  <div class="modal-content" style="width: 95%; max-width: 900px;">
    <span class="close" onclick="closeMonthlyBalanceModal()">&times;</span>
    <h2>Monthly Total Balance</h2>
    <div id="chartWrapper" style="overflow-x:auto; cursor: grab;">
      <canvas id="monthlyBalanceChart" height="300"></canvas>
    </div>
  </div>
</div>

<div id="settingsModal" class="modal">
  <div class="modal-content small-modal">
    <span class="close" onclick="closeSettingsModal()">&times;</span>
    <h2>Data & App Settings</h2>
    
    <div style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
        <button onclick="exportData()" style="background:#555; color:#fff;">Export Data (JSON)</button>
        
        <label for="importFile" style="cursor:pointer; padding: 10px 20px; border-radius: 12px; border: none; background: #555; color: #fff; font-weight: bold; text-align:center; transition: 0.25s; margin: 5px 0;">
            Import Data (JSON)
        </label>
        <input type="file" id="importFile" style="display:none" onchange="importData(event)">
        
        <button onclick="clearAll()" style="background:#ff4c4c; color:#121212; margin-top:20px;">Clear All Data</button>
        <p style="font-size: 0.8em; color: #999; text-align:center;">
            Warning: This action is permanent and clears both local and cloud data.
        </p>
    </div>
  </div>
</div>

<script type="module" src="app.js"></script> 

</body>
</html>